var dt=e=>{throw TypeError(e)};var Z=(e,t,s)=>t.has(e)||dt("Cannot "+s);var r=(e,t,s)=>(Z(e,t,"read from private field"),s?s.call(e):t.get(e)),y=(e,t,s)=>t.has(e)?dt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),c=(e,t,s,i)=>(Z(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),l=(e,t,s)=>(Z(e,t,"access private method"),s);import{aK as St,aQ as ft,aR as w,aS as $,aT as B,aN as G,aU as J,aV as pt,aW as Ot,aX as Et,aY as Qt,aZ as yt,aL as vt,r as S,a_ as It,y as Tt}from"./index-BDpQ_Sx3.js";var g,a,H,b,T,D,O,E,N,M,P,x,F,Q,_,n,A,tt,et,st,rt,it,at,nt,Ct,Rt,xt=(Rt=class extends St{constructor(t,s){super();y(this,n);y(this,g);y(this,a);y(this,H);y(this,b);y(this,T);y(this,D);y(this,O);y(this,E);y(this,N);y(this,M);y(this,P);y(this,x);y(this,F);y(this,Q);y(this,_,new Set);this.options=s,c(this,g,t),c(this,E,null),c(this,O,ft()),this.options.experimental_prefetchInRender||r(this,O).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,a).addObserver(this),bt(r(this,a),this.options)?l(this,n,A).call(this):this.updateResult(),l(this,n,rt).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ot(r(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ot(r(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,l(this,n,it).call(this),l(this,n,at).call(this),r(this,a).removeObserver(this)}setOptions(t){const s=this.options,i=r(this,a);if(this.options=r(this,g).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof w(this.options.enabled,r(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");l(this,n,nt).call(this),r(this,a).setOptions(this.options),s._defaulted&&!$(this.options,s)&&r(this,g).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,a),observer:this});const d=this.hasListeners();d&&gt(r(this,a),i,this.options,s)&&l(this,n,A).call(this),this.updateResult(),d&&(r(this,a)!==i||w(this.options.enabled,r(this,a))!==w(s.enabled,r(this,a))||B(this.options.staleTime,r(this,a))!==B(s.staleTime,r(this,a)))&&l(this,n,tt).call(this);const h=l(this,n,et).call(this);d&&(r(this,a)!==i||w(this.options.enabled,r(this,a))!==w(s.enabled,r(this,a))||h!==r(this,Q))&&l(this,n,st).call(this,h)}getOptimisticResult(t){const s=r(this,g).getQueryCache().build(r(this,g),t),i=this.createResult(s,t);return Ut(this,i)&&(c(this,b,i),c(this,D,this.options),c(this,T,r(this,a).state)),i}getCurrentResult(){return r(this,b)}trackResult(t,s){return new Proxy(t,{get:(i,d)=>(this.trackProp(d),s==null||s(d),Reflect.get(i,d))})}trackProp(t){r(this,_).add(t)}getCurrentQuery(){return r(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=r(this,g).defaultQueryOptions(t),i=r(this,g).getQueryCache().build(r(this,g),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return l(this,n,A).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,b)))}createResult(t,s){var lt;const i=r(this,a),d=this.options,h=r(this,b),o=r(this,T),I=r(this,D),v=t!==i?t.state:r(this,H),{state:L}=t;let u={...L},k=!1,f;if(s._optimisticResults){const R=this.hasListeners(),W=!R&&bt(t,s),U=R&&gt(t,i,s,d);(W||U)&&(u={...u,...Qt(L.data,t.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:q,errorUpdatedAt:j,status:m}=u;f=u.data;let V=!1;if(s.placeholderData!==void 0&&f===void 0&&m==="pending"){let R;h!=null&&h.isPlaceholderData&&s.placeholderData===(I==null?void 0:I.placeholderData)?(R=h.data,V=!0):R=typeof s.placeholderData=="function"?s.placeholderData((lt=r(this,P))==null?void 0:lt.state.data,r(this,P)):s.placeholderData,R!==void 0&&(m="success",f=yt(h==null?void 0:h.data,R,s),k=!0)}if(s.select&&f!==void 0&&!V)if(h&&f===(o==null?void 0:o.data)&&s.select===r(this,N))f=r(this,M);else try{c(this,N,s.select),f=s.select(f),f=yt(h==null?void 0:h.data,f,s),c(this,M,f),c(this,E,null)}catch(R){c(this,E,R)}r(this,E)&&(q=r(this,E),f=r(this,M),j=Date.now(),m="error");const K=u.fetchStatus==="fetching",X=m==="pending",Y=m==="error",ct=X&&K,ut=f!==void 0,C={status:m,fetchStatus:u.fetchStatus,isPending:X,isSuccess:m==="success",isError:Y,isInitialLoading:ct,isLoading:ct,data:f,dataUpdatedAt:u.dataUpdatedAt,error:q,errorUpdatedAt:j,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>v.dataUpdateCount||u.errorUpdateCount>v.errorUpdateCount,isFetching:K,isRefetching:K&&!X,isLoadingError:Y&&!ut,isPaused:u.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:Y&&ut,isStale:ht(t,s),refetch:this.refetch,promise:r(this,O)};if(this.options.experimental_prefetchInRender){const R=z=>{C.status==="error"?z.reject(C.error):C.data!==void 0&&z.resolve(C.data)},W=()=>{const z=c(this,O,C.promise=ft());R(z)},U=r(this,O);switch(U.status){case"pending":t.queryHash===i.queryHash&&R(U);break;case"fulfilled":(C.status==="error"||C.data!==U.value)&&W();break;case"rejected":(C.status!=="error"||C.error!==U.reason)&&W();break}}return C}updateResult(){const t=r(this,b),s=this.createResult(r(this,a),this.options);if(c(this,T,r(this,a).state),c(this,D,this.options),r(this,T).data!==void 0&&c(this,P,r(this,a)),$(s,t))return;c(this,b,s);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:d}=this.options,h=typeof d=="function"?d():d;if(h==="all"||!h&&!r(this,_).size)return!0;const o=new Set(h??r(this,_));return this.options.throwOnError&&o.add("error"),Object.keys(r(this,b)).some(I=>{const p=I;return r(this,b)[p]!==t[p]&&o.has(p)})};l(this,n,Ct).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&l(this,n,rt).call(this)}},g=new WeakMap,a=new WeakMap,H=new WeakMap,b=new WeakMap,T=new WeakMap,D=new WeakMap,O=new WeakMap,E=new WeakMap,N=new WeakMap,M=new WeakMap,P=new WeakMap,x=new WeakMap,F=new WeakMap,Q=new WeakMap,_=new WeakMap,n=new WeakSet,A=function(t){l(this,n,nt).call(this);let s=r(this,a).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(G)),s},tt=function(){l(this,n,it).call(this);const t=B(this.options.staleTime,r(this,a));if(J||r(this,b).isStale||!pt(t))return;const i=Ot(r(this,b).dataUpdatedAt,t)+1;c(this,x,setTimeout(()=>{r(this,b).isStale||this.updateResult()},i))},et=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,a)):this.options.refetchInterval)??!1},st=function(t){l(this,n,at).call(this),c(this,Q,t),!(J||w(this.options.enabled,r(this,a))===!1||!pt(r(this,Q))||r(this,Q)===0)&&c(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||Et.isFocused())&&l(this,n,A).call(this)},r(this,Q)))},rt=function(){l(this,n,tt).call(this),l(this,n,st).call(this,l(this,n,et).call(this))},it=function(){r(this,x)&&(clearTimeout(r(this,x)),c(this,x,void 0))},at=function(){r(this,F)&&(clearInterval(r(this,F)),c(this,F,void 0))},nt=function(){const t=r(this,g).getQueryCache().build(r(this,g),this.options);if(t===r(this,a))return;const s=r(this,a);c(this,a,t),c(this,H,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Ct=function(t){vt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(r(this,b))}),r(this,g).getQueryCache().notify({query:r(this,a),type:"observerResultsUpdated"})})},Rt);function Ft(e,t){return w(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function bt(e,t){return Ft(e,t)||e.state.data!==void 0&&ot(e,t,t.refetchOnMount)}function ot(e,t,s){if(w(t.enabled,e)!==!1&&B(t.staleTime,e)!=="static"){const i=typeof s=="function"?s(e):s;return i==="always"||i!==!1&&ht(e,t)}return!1}function gt(e,t,s,i){return(e!==t||w(i.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&ht(e,s)}function ht(e,t){return w(t.enabled,e)!==!1&&e.isStaleByTime(B(t.staleTime,e))}function Ut(e,t){return!$(e.getCurrentResult(),t)}var wt=S.createContext(!1),Dt=()=>S.useContext(wt);wt.Provider;function Mt(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Pt=S.createContext(Mt()),_t=()=>S.useContext(Pt),Lt=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},kt=e=>{S.useEffect(()=>{e.clearReset()},[e])},qt=({result:e,errorResetBoundary:t,throwOnError:s,query:i,suspense:d})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(d&&e.data===void 0||It(s,[e.error,i])),jt=e=>{if(e.suspense){const t=i=>i==="static"?i:Math.max(i??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...i)=>t(s(...i)):t(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},At=(e,t)=>e.isLoading&&e.isFetching&&!t,Bt=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,mt=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Ht(e,t,s){var u,k,f,q,j;if(typeof e!="object"||Array.isArray(e))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const i=Tt(),d=Dt(),h=_t(),o=i.defaultQueryOptions(e);(k=(u=i.getDefaultOptions().queries)==null?void 0:u._experimental_beforeQuery)==null||k.call(u,o),o.queryFn||console.error(`[${o.queryHash}]: No queryFn was passed as an option, and no default queryFn was found. The queryFn parameter is only optional when using a default queryFn. More info here: https://tanstack.com/query/latest/docs/framework/react/guides/default-query-function`),o._optimisticResults=d?"isRestoring":"optimistic",jt(o),Lt(o,h),kt(h);const I=!i.getQueryCache().get(o.queryHash),[p]=S.useState(()=>new t(i,o)),v=p.getOptimisticResult(o),L=!d&&e.subscribed!==!1;if(S.useSyncExternalStore(S.useCallback(m=>{const V=L?p.subscribe(vt.batchCalls(m)):G;return p.updateResult(),V},[p,L]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),S.useEffect(()=>{p.setOptions(o)},[o,p]),Bt(o,v))throw mt(o,p,h);if(qt({result:v,errorResetBoundary:h,throwOnError:o.throwOnError,query:i.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw v.error;if((q=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||q.call(f,o,v),o.experimental_prefetchInRender&&!J&&At(v,d)){const m=I?mt(o,p,h):(j=i.getQueryCache().get(o.queryHash))==null?void 0:j.promise;m==null||m.catch(G).finally(()=>{p.updateResult()})}return o.notifyOnChangeProps?v:p.trackResult(v)}function zt(e,t){return Ht(e,xt)}export{xt as Q,_t as a,Lt as b,kt as c,zt as d,jt as e,mt as f,qt as g,Bt as s,Dt as u,At as w};
